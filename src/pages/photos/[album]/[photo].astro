---
import { Image } from "astro:assets";
import {
  getAlbumPhotos,
  getAlbumPhoto,
  getSubAlbum,
  getPreviousPhoto,
  getNextPhoto,
} from "@src/lib/photos.ts";
import Layout from "@src/layouts/Layout.astro";
import GalleryIndex from "@src/components/Gallery/Index.astro";
import type { GetStaticPaths } from "astro";
import type { Photo, SubAlbum } from "@src/env";

interface Params {
  album: string;
  photo: string;
}

export const getStaticPaths = (() => {
  const albums = ["digital-nomad"];

  return albums.flatMap((album) => {
    return getAlbumPhotos(album).map((photo) => {
      return { params: { album: photo.album, photo: photo.name } };
    });
  });
}) satisfies GetStaticPaths;

const { album, photo } = Astro.params as Params;
const photoObj = getAlbumPhoto(album, photo);
let subAlbum: SubAlbum | undefined;
let previousPhoto: Photo | undefined;
let nextPhoto: Photo | undefined;

if (photoObj) {
  subAlbum = getSubAlbum(album, photoObj.subAlbum) || [];
  previousPhoto = getPreviousPhoto(photoObj);
  nextPhoto = getNextPhoto(photoObj);
}
---

<Layout>
  <div class="flex">
    <div>
      {
        previousPhoto && (
          <a href={`/photos/${album}/${previousPhoto.name}`}>
            <Image src={previousPhoto.import()} alt={previousPhoto.name} />
          </a>
        )
      }
    </div>
    <div>
      {
        nextPhoto && (
          <a href={`/photos/${album}/${nextPhoto.name}`}>
            <Image src={nextPhoto.import()} alt={nextPhoto.name} />
          </a>
        )
      }
    </div>
  </div>

  {photoObj && <Image src={photoObj.import()} alt={photoObj.name} />}

  <GalleryIndex {subAlbum} />
</Layout>
