---
import { Image } from "astro:assets";
import {
  getAlbumPhotos,
  getAlbumPhoto,
  getSubAlbumPhotos,
} from "@src/lib/photos.ts";
import Layout from "@src/layouts/Layout.astro";
import type { GetStaticPaths } from "astro";

interface Params {
  album: string;
  photo: string;
}

export const getStaticPaths = (() => {
  const albums = ["digital-nomad"];

  return albums.flatMap((album) => {
    return getAlbumPhotos(album).map((photo) => {
      return { params: { album: photo.album, photo: photo.name } };
    });
  });
}) satisfies GetStaticPaths;

const { album, photo } = Astro.params as Params;
const photoObj = getAlbumPhoto(album, photo);
const subAlbumPhotos = getSubAlbumPhotos(album, photoObj?.subAlbum || "") || [];
---

<Layout>
  {photoObj && <Image src={photoObj.import()} alt={photoObj.name} />}
  <ul class="flex">
    {
      subAlbumPhotos.map((photo) => (
        <li>
          <a href={`/photos/${album}/${photo.name}`}>
            <Image src={photo.import()} alt={photo.name} />
          </a>
        </li>
      ))
    }
  </ul>
</Layout>
