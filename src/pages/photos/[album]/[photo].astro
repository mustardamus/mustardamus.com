---
import { getAlbumPhotos, getAlbumPhoto, getSubAlbum } from "@src/lib/photos.ts";
import Layout from "@src/layouts/Layout.astro";
import GalleryShow from "@src/components/Gallery/Show.astro";
import GalleryIndex from "@src/components/Gallery/Index.astro";
import type { GetStaticPaths } from "astro";
import type { Photo, SubAlbum } from "@src/env";

interface Params {
  album: string;
  photo: string;
}

export const getStaticPaths = (() => {
  const albums = ["digital-nomad"];

  return albums.flatMap((album) => {
    return getAlbumPhotos(album).map((photo) => {
      return { params: { album: photo.album, photo: photo.name } };
    });
  });
}) satisfies GetStaticPaths;

const { album, photo } = Astro.params as Params;
const photoObj = getAlbumPhoto(album, photo);
const subAlbum: SubAlbum | undefined =
  photoObj && getSubAlbum(album, photoObj.subAlbum);
---

<Layout>
  <div class="mt-5">
    {photoObj && <GalleryShow photo={photoObj} />}
  </div>

  <div class="my-10">
    {subAlbum && <GalleryIndex {subAlbum} showBackLink={true} />}
  </div>
</Layout>
